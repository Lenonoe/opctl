{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "https://spec.opspec.io/0.1.3/schema/run-declaration.json",
  "title": "runDeclaration",
  "description": "What to run",
  "oneOf": [
    {
      "$ref": "#/definitions/opRunDeclaration"
    },
    {
      "$ref": "#/definitions/parallelRunDeclaration"
    },
    {
      "$ref": "#/definitions/serialRunDeclaration"
    }
  ],
  "definitions": {
    "containerRunDeclaration": {
      "title": "containerRunDeclaration",
      "description": "Container to run",
      "type": "object",
      "properties": {
        "cmd": {
          "description": "Command to run (overrides any defined by image)",
          "type": "string"
        },
        "env": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/containerEnvEntry"
          }
        },
        "fs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/containerFsEntry"
          }
        },
        "image": {
          "$ref": "#/definitions/dockerImageRef"
        },
        "net": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/containerNetEntry"
          }
        },
        "workDir": {
          "description": "Working directory path (overrides any defined by image)",
          "type": "string"
        }
      }
    },
    "containerEnvEntry": {
      "title": "containerEnvEntry",
      "description": "Entry in a containers environment; an environment variable",
      "type": "object",
      "properties": {
        "bind": {
          "description": "Op parameter to bind the env variable to",
          "type": "string"
        },
        "name": {
          "description": "Name of the env variable",
          "type": "string"
        }
      }
    },
    "containerFsEntry": {
      "title": "containerFsEntry",
      "description": "Entry in a containers filesystem; a file/directory",
      "type": "object",
      "properties": {
        "bind": {
          "description": "Op parameter to bind the file/directory to",
          "type": "string"
        },
        "path": {
          "description": "Path of the file/directory",
          "type": "string"
        }
      }
    },
    "containerNetEntry": {
      "title": "containerNetEntry",
      "description": "Entry in a containers network; a network socket",
      "type": "object",
      "properties": {
        "bind": {
          "description": "Op parameter to bind the network socket to",
          "type": "string"
        },
        "port": {
          "description": "Port number of the socket",
          "type": "string"
        }
      }
    },
    "opRunDeclaration": {
      "title": "opRunDeclaration",
      "description": "Op to run",
      "type": "object",
      "properties": {
        "op": {
          "type": "object",
          "properties": {
            "ref": {
              "$ref": "#/definitions/opRef"
            },
            "args": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "results": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "required": [
            "ref"
          ]
        }
      },
      "required": [
        "op"
      ],
      "additionalProperties": false
    },
    "parallelRunDeclaration": {
      "title": "parallelRunDeclaration",
      "description": "Sequence of run declarations to run in parallel",
      "type": "object",
      "properties": {
        "parallel": {
          "type": "array",
          "items": {
            "$ref": "#"
          }
        }
      },
      "required": [
        "parallel"
      ],
      "additionalProperties": false
    },
    "serialRunDeclaration": {
      "title": "serialRunDeclaration",
      "description": "Sequence of run declarations to run serially",
      "type": "object",
      "properties": {
        "serial": {
          "type": "array",
          "items": {
            "$ref": "#"
          }
        }
      },
      "required": [
        "serial"
      ],
      "additionalProperties": false
    },
    "dockerImageRef": {
      "title": "dockerImageRef",
      "description": "Reference to a docker image",
      "type": "string"
    },
    "opRef": {
      "title": "opRef",
      "description": "Reference to an op",
      "type": "string"
    }
  }
}
