description: publishes code coverage
name: publish-coverage
inputs:
  coverageTxtFile:
    file:
      description: aggregate of all test coverage metrics
  gitBranch:
    string:
      constraints: { minLength: 1 }
      description: git branch coverage should be associated with
      default: master
  gitCommit:
    string:
      constraints: { minLength: 1 }
      description: git commit the coverage should be associated with
run:
  container:
    cmd:
      - sh
      - -ce
      - |
        echo "publishing coverage"
        curl -s https://codecov.io/bash | bash -s
    envVars:
      CODECOV_TOKEN: 5f64e6aa-5117-410b-aceb-3188c58e4a18
      GIT_BRANCH: $(gitBranch)
      GIT_COMMIT: $(gitCommit)
    files:
      /workDir/coverage.txt: { bind: coverageTxtFile }
    image: golang:1.8
    workDir: /workDir
